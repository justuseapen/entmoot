{
  "project": "Entmoot",
  "branchName": "ralph/soft-launch-backend",
  "description": "Newsletter subscription API, Terms/Privacy LTD updates, and QA test coverage for soft launch",
  "userStories": [
    {
      "id": "US-001",
      "title": "Create NewsletterSubscription model",
      "description": "As a developer, I need a model to store newsletter email subscriptions.",
      "acceptanceCriteria": [
        "Create NewsletterSubscription model in backend/app/models/newsletter_subscription.rb",
        "Fields: email (string), status (enum: pending/confirmed/unsubscribed), subscribed_at (datetime), unsubscribed_at (datetime nullable)",
        "Add email format validation using URI::MailTo::EMAIL_REGEXP",
        "Add uniqueness validation on email (case_sensitive: false)",
        "Add enum for status: { pending: 0, confirmed: 1, unsubscribed: 2 }",
        "Default status to pending",
        "Typecheck passes (bundle exec rubocop)"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Created NewsletterSubscription model with email validation (format + uniqueness case-insensitive), status enum (pending/confirmed/unsubscribed). Rubocop passes."
    },
    {
      "id": "US-002",
      "title": "Create newsletter_subscriptions migration",
      "description": "As a developer, I need a database table for newsletter subscriptions.",
      "acceptanceCriteria": [
        "Run: rails generate migration CreateNewsletterSubscriptions",
        "Add columns: email:string (null: false), status:integer (default: 0), subscribed_at:datetime, unsubscribed_at:datetime, timestamps",
        "Add unique index on email column",
        "Add index on status column",
        "Run migration: bundle exec rails db:migrate",
        "Verify migration succeeds",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Created migration with email (not null, unique index), status (default 0, indexed), subscribed_at, unsubscribed_at, timestamps. Migration ran successfully."
    },
    {
      "id": "US-003",
      "title": "Create NewsletterSubscriptionsController",
      "description": "As a visitor, I want to subscribe to the newsletter with my email.",
      "acceptanceCriteria": [
        "Create Api::V1::NewsletterSubscriptionsController in backend/app/controllers/api/v1/",
        "Implement create action accepting { email: string } in params",
        "Skip authentication using skip_before_action :authenticate_user! (public endpoint)",
        "Return 201 with { message: 'Successfully subscribed', email: email } on success",
        "Return 422 with { errors: [...] } if validation fails",
        "Set subscribed_at to Time.current on creation",
        "Handle duplicate email with friendly 'already subscribed' message",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Created controller with skip_before_action :authenticate_user!, create action accepting email param, returning 201 on success and 422 on validation/duplicate errors. Sets subscribed_at on creation. Rubocop passes."
    },
    {
      "id": "US-004",
      "title": "Add newsletter route and request specs",
      "description": "As a developer, I need the route configured and tested.",
      "acceptanceCriteria": [
        "Add route in config/routes.rb: post 'newsletter/subscribe', to: 'newsletter_subscriptions#create' inside api/v1 namespace",
        "Create spec/requests/api/v1/newsletter_subscriptions_spec.rb",
        "Test successful subscription returns 201 and correct JSON",
        "Test invalid email format returns 422",
        "Test duplicate email returns 422 with 'already subscribed' message",
        "Test missing email returns 422",
        "Run: bundle exec rspec spec/requests/api/v1/newsletter_subscriptions_spec.rb",
        "All specs pass",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Added route POST /api/v1/newsletter/subscribe. Created comprehensive request specs (10 examples) testing success, invalid format, duplicates (case-insensitive), and missing/empty email. All specs pass, rubocop clean."
    },
    {
      "id": "US-005",
      "title": "Update Terms of Service for LTD no-refund policy",
      "description": "As a user, I need to see accurate terms regarding the lifetime deal and refund policy.",
      "acceptanceCriteria": [
        "Update frontend/src/pages/Terms.tsx",
        "Import HERITAGE_COLORS from @/components/landing/design-system",
        "Replace LANDING_COLORS constant with HERITAGE_COLORS throughout file",
        "Replace TreePine icon with inline SVG or img tag for /logo-medallion.svg",
        "Update Refund Policy section (lines 206-217) with No Refunds policy",
        "New text: 'All purchases of the Founding Family Edition are final. Due to the nature of lifetime access and immediate product delivery, we do not offer refunds. Please ensure Entmoot is right for your family before purchasing.'",
        "Section title should be 'Refund Policy - Final Sale'",
        "Typecheck passes (npm run build)"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Update Privacy Policy with heritage design and LTD clarity",
      "description": "As a user, I need to understand data practices for lifetime customers.",
      "acceptanceCriteria": [
        "Update frontend/src/pages/Privacy.tsx",
        "Import HERITAGE_COLORS from @/components/landing/design-system",
        "Replace LANDING_COLORS constant with HERITAGE_COLORS throughout file",
        "Replace TreePine icon with inline SVG or img tag for /logo-medallion.svg",
        "Add new section 'Lifetime Access Data Retention' after 'Data Retention'",
        "Content: 'For Founding Family lifetime access customers, we retain your data for as long as the Entmoot service remains operational. Your lifetime access includes all future feature updates. In the event of service discontinuation, we will provide advance notice and data export options.'",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Create comprehensive role permissions spec",
      "description": "As a developer, I need automated tests verifying all 5 user roles have correct permissions.",
      "acceptanceCriteria": [
        "Create spec/requests/role_permissions_spec.rb",
        "Create test family with users for each role: admin, adult, teen, child, observer",
        "Test Goals CRUD: admin (all), adult (own+view family), teen (own), child (limited), observer (view only)",
        "Test DailyPlans: all authenticated users can create own plans, observer cannot",
        "Test WeeklyReviews: admin/adult can create, teen/child limited, observer view only",
        "Test TopPriorities: tied to daily plans, follow same rules",
        "Verify 403 Forbidden for unauthorized actions",
        "Verify 200/201 for authorized actions",
        "All specs pass (bundle exec rspec spec/requests/role_permissions_spec.rb)",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Create multi-family switching spec",
      "description": "As a developer, I need automated tests for multi-family data isolation.",
      "acceptanceCriteria": [
        "Create spec/requests/multi_family_spec.rb",
        "Create user with memberships in 2 different families (family_a and family_b)",
        "Create goals in both families",
        "Verify GET /api/v1/families/:family_a_id/goals returns only family_a goals",
        "Verify GET /api/v1/families/:family_b_id/goals returns only family_b goals",
        "Verify user cannot access goals via wrong family_id (403)",
        "Verify user cannot access family they don't belong to (403)",
        "All specs pass",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Create onboarding flow integration spec",
      "description": "As a developer, I need automated tests for the complete onboarding flow.",
      "acceptanceCriteria": [
        "Create spec/requests/onboarding_flow_spec.rb",
        "Test POST /users creates user successfully",
        "Test POST /api/v1/families creates family with current user as admin",
        "Test first family member automatically gets admin role",
        "Test POST /api/v1/families/:id/invitations creates invitation",
        "Test accepting invitation adds user with correct role",
        "Test user can create first goal after onboarding",
        "Test tour_completed flag can be updated via user preferences endpoint",
        "All specs pass",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    }
  ]
}

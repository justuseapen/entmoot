# Ralph Progress Log
Started: Mon Jan 12 17:13:26 EST 2026

## Codebase Patterns
- FeedbackReport model already supports `nps` and `quick_feedback` report types
- Use `context_data` JSONB field to store additional metadata (score, feature name, rating)
- React contexts must be in separate files to avoid fast-refresh lint errors
- ProactiveFeedbackProvider wraps the app and manages NPS, feature, and session feedback state
- Hooks in `/hooks/useProactiveFeedback.ts` provide convenient triggers for feedback components
- Landing page design system colors: forestGreen #2D5A27, leafGreen #7CB342, skyBlue #64B5F6, warmGold #FFD54F, earthBrown #795548, creamWhite #FFF8E7, sunsetOrange #FF7043, darkForest #1B3A1A
- Landing page components go in `/frontend/src/components/landing/`
- useScrollAnimation hook pattern: use Intersection Observer with initial state from prefersReducedMotion
- To avoid setState-in-effect lint error: initialize useState with the condition value, not set it in useEffect
- AnimatedSection wrapper provides consistent fade-in animation for landing sections
- Mobile app: Use @/ for src imports, @shared/ for shared types. Structure: /mobile/src/{screens,components,hooks,lib,stores,navigation}
- Mobile navigation: AuthNavigator (stack), MainTabNavigator (tabs), RootNavigator (root) - types in navigation/types.ts
- Shared types in /shared/types/index.ts can be imported by both web and mobile apps
- ESLint 9 requires flat config format (eslint.config.js), not .eslintrc.* files
---

## 2026-01-12 17:30 - US-046 Proactive Feedback Collection
- What was implemented:
  - Backend: Added `last_nps_prompt_date` to users table
  - Backend: Created ProactiveFeedbackService with NPS eligibility logic (30 days active, quarterly max)
  - Backend: Added 3 new endpoints: /feedback/eligibility, /feedback/dismiss_nps, /feedback/nps_follow_up
  - Backend: Auto-records NPS/feature feedback when feedback is submitted
  - Frontend: NPSSurvey component (0-10 scale with follow-up questions by category)
  - Frontend: FeatureFeedback component (thumbs up/down with optional expansion)
  - Frontend: SessionFeedback component (emoji scale 1-5)
  - Frontend: ProactiveFeedbackProvider context and hooks

- Files changed:
  - backend/db/migrate/20260112221500_add_last_nps_prompt_date_to_users.rb
  - backend/app/services/proactive_feedback_service.rb
  - backend/app/controllers/api/v1/feedback_controller.rb
  - backend/config/routes.rb
  - backend/spec/services/proactive_feedback_service_spec.rb
  - backend/spec/requests/api/v1/feedback_spec.rb
  - frontend/src/lib/feedback.ts
  - frontend/src/hooks/useFeedback.ts
  - frontend/src/hooks/useProactiveFeedback.ts
  - frontend/src/contexts/ProactiveFeedbackContext.ts
  - frontend/src/components/NPSSurvey.tsx
  - frontend/src/components/FeatureFeedback.tsx
  - frontend/src/components/SessionFeedback.tsx
  - frontend/src/components/ProactiveFeedbackProvider.tsx

- **Learnings for future iterations:**
  - React contexts MUST be in separate files from components to avoid fast-refresh lint errors
  - FeedbackReport model already has nps and quick_feedback types - just use them
  - Use `context_data` JSONB to store score, follow_up, feature, rating metadata
  - NPS category logic: 9-10 = promoter, 7-8 = passive, 0-6 = detractor
  - ProactiveFeedbackService.should_show_nps? checks: 30 days old, has activity, not prompted in 90 days
  - localStorage used as immediate fallback for feedback state, synced to server
---

## 2026-01-12 - US-047 Landing Page Route and Structure
- What was implemented:
  - Created LandingPage component at /frontend/src/pages/LandingPage.tsx
  - Updated App.tsx routing to render LandingPage at / for unauthenticated users
  - Authenticated users at / are redirected to /dashboard via Navigate component
  - Applied cream white background color (#FFF8E7) from design system
  - Created /frontend/src/components/landing/ directory for future landing components
  - Implemented responsive layout with mobile, tablet, desktop breakpoints

- Files changed:
  - frontend/src/pages/LandingPage.tsx (new)
  - frontend/src/App.tsx (updated route and import)

- **Learnings for future iterations:**
  - Landing page design system colors defined in prd.json under `landingPageDesignSystem`
  - LandingPage includes internal redirect logic for authenticated users
  - The landing components directory is empty - future stories (US-048 through US-060) will add components there
  - Responsive breakpoints: sm: 640px, lg: 1024px (Tailwind defaults)
  - Home.tsx is no longer used but wasn't deleted - can be removed later if needed
---

## 2026-01-12 17:30 - US-048 Landing Page Navigation Bar
- What was implemented:
  - Created LandingNav component at /frontend/src/components/landing/LandingNav.tsx
  - TreePine logo icon with "Entmoot" text as navigation brand
  - Desktop navigation links: Features, How It Works, Pricing (smooth scroll to sections)
  - Sign In link (text link to /login) and Get Started CTA button (forest green, links to /register)
  - Sticky header with transparent background over hero, solid cream white (#FFF8E7) on scroll
  - Mobile hamburger menu with slide-out drawer using shadcn/ui Sheet component
  - Smooth scroll functionality via scrollIntoView({ behavior: "smooth" })
  - Added placeholder sections with IDs (#features, #how-it-works, #pricing) for scroll targets
  - Added pt-24 padding to hero section to account for fixed navbar height

- Files changed:
  - frontend/src/components/landing/LandingNav.tsx (new)
  - frontend/src/pages/LandingPage.tsx (updated to include LandingNav and placeholder sections)

- **Learnings for future iterations:**
  - Use useState for scroll position tracking with window.scrollY > 50 threshold
  - Sheet component from shadcn/ui works well for mobile drawer navigation
  - Placeholder sections with IDs allow smooth scroll to work before full section implementations
  - Fixed navbar requires padding-top on first content section to prevent overlap
  - Landing page colors are duplicated between LandingNav and LandingPage - consider extracting to shared constants
---

## 2026-01-12 - US-049 Landing Page Hero Section
- What was implemented:
  - Created HeroSection component at /frontend/src/components/landing/HeroSection.tsx
  - Dawn to sky blue gradient background (pink -> peach -> sky blue)
  - Blocky forest silhouette at bottom using SVG BlockyTree components (Minecraft-inspired)
  - Floating island decorative elements with CSS keyframe animation
  - Headline: "Build Your Family's Adventure, One Goal at a Time"
  - Subheadline about transforming chaotic days into epic quests
  - Primary CTA: "Start Your Free Adventure" (forest green button with Star icon)
  - Secondary CTA: "Watch Demo" (outlined button with Play icon)
  - Trust badges: "No credit card required • Free for families up to 5"
  - Full viewport height on desktop, responsive on mobile
  - Updated LandingPage.tsx to use HeroSection component

- Files changed:
  - frontend/src/components/landing/HeroSection.tsx (new)
  - frontend/src/pages/LandingPage.tsx (updated to use HeroSection)

- **Learnings for future iterations:**
  - Each landing component should define its own LANDING_COLORS constant (or extract to shared module)
  - CSS keyframes can be embedded in style tags within React components
  - animate-float class uses 4s ease-in-out infinite animation for smooth floating effect
  - BlockyTree SVG uses stacked rectangles for Minecraft-style pixelated look
  - FloatingIsland components use absolute positioning and hidden on smaller screens (lg:block)
  - Hero section needs pb-32 to leave room for forest silhouette overlay
---

## 2026-01-12 - US-050 Landing Page Social Proof Bar
- What was implemented:
  - Created SocialProofBar component at /frontend/src/components/landing/SocialProofBar.tsx
  - Horizontal bar with soft green gradient background (leafGreen 25% -> forestGreen 20%)
  - Stats: "2,847 Families Adventuring" with TreePine icon in circular background
  - Star rating: "4.9/5" with 5 filled Star icons and "from 500+ reviews" text
  - Featured quote: "Finally, a planning app my kids actually WANT to use!" — Sarah M., Mom of 3
  - Responsive layout: horizontal on desktop/tablet, stacks vertically on mobile
  - Animated count-up effect using custom useCountUp hook with Intersection Observer
  - Count-up uses ease-out cubic easing for smooth deceleration

- Files changed:
  - frontend/src/components/landing/SocialProofBar.tsx (new)
  - frontend/src/pages/LandingPage.tsx (added SocialProofBar import and usage)

- **Learnings for future iterations:**
  - useCountUp hook pattern: track visibility with IntersectionObserver, animate with requestAnimationFrame
  - tabular-nums CSS class ensures consistent number width during count animation
  - Intersection Observer threshold of 0.3 works well for triggering animations when section scrolls into view
  - Quote component uses rotated Quote icon (rotate-180) for opening quote style
  - StarRating component fills stars based on rating value (fullStars + hasHalfStar logic)
---

## 2026-01-12 - US-051 Landing Page Problem/Solution Section
- What was implemented:
  - Created ProblemSolutionSection component at /frontend/src/components/landing/ProblemSolutionSection.tsx
  - Section headline: "Sound Familiar?"
  - Two-column grid layout: "Without Entmoot" (red-tinted) vs "With Entmoot" (green-tinted)
  - Pain points with emoji icons: dog feeding, soccer, grandma pickup, no fun activities
  - Solutions with checkmark icons: quests tracked, everyone sees map, goals connected, celebrations built in
  - Transition quote: "Every family deserves to feel like a team on an epic quest..."
  - BlockyCard component with pixelated border effect using box-shadows and corner accents
  - Responsive: stacks on mobile, side-by-side on tablet/desktop

- Files changed:
  - frontend/src/components/landing/ProblemSolutionSection.tsx (new)
  - frontend/src/pages/LandingPage.tsx (added import and usage after SocialProofBar)

- **Learnings for future iterations:**
  - BlockyCard uses inset and outset box-shadows to create pixelated border effect
  - Small corner accent divs (2x2px) add to the blocky/Minecraft visual style
  - Red colors for problem: #FEE2E2 background, #FECACA/#FCA5A5 inset shadows, #F87171 outset
  - Green colors for solution: #DCFCE7 background, #BBF7D0/#86EFAC inset shadows, leafGreen outset
  - PainPointItem combines emoji in rounded-lg box with X icon and text
  - SolutionItem uses Check icon in leafGreen-tinted circle
  - Section placed after SocialProofBar and before Features placeholder
---

## 2026-01-12 - US-052 Landing Page Features Section
- What was implemented:
  - Created FeaturesSection component at /frontend/src/components/landing/FeaturesSection.tsx
  - Section headline: "Your Family's Toolkit for Epic Adventures"
  - Subheadline: "Everything you need to plan, play, and grow together"
  - 6 feature cards in responsive grid (1 col mobile, 2 cols tablet, 3 cols desktop)
  - Feature 1: SMART Quest Builder (Target icon) - AI-powered goal creation
  - Feature 2: Goal Hierarchy Map (Map icon) - Visual goal connections
  - Feature 3: Morning Planning Ritual (Sun icon) - Daily intention setting
  - Feature 4: Evening Reflection (Moon icon) - Gratitude and wins
  - Feature 5: Family Leaderboard (Trophy icon) - Gamification
  - Feature 6: Role-Based Permissions (Users icon) - Age-appropriate access
  - Each card has warm gold (#FFD54F) background circle for icon
  - Cards lift with shadow on hover using translate-y-1 and dynamic box-shadow
  - Replaced placeholder Features section in LandingPage.tsx with real FeaturesSection component

- Files changed:
  - frontend/src/components/landing/FeaturesSection.tsx (new)
  - frontend/src/pages/LandingPage.tsx (updated import and replaced placeholder)

- **Learnings for future iterations:**
  - FeatureCard hover effect uses onMouseEnter/onMouseLeave for dynamic box-shadow changes
  - Icon type annotation: `React.ComponentType<{ className?: string; style?: React.CSSProperties }>`
  - Lucide icons: Target, Map, Sun, Moon, Trophy, Users used as specified in PRD
  - Responsive grid: grid gap-6 sm:grid-cols-2 lg:grid-cols-3 lg:gap-8
  - White background cards with rounded-xl and default shadow give clean card appearance
---

## 2026-01-12 - US-053 Landing Page How It Works Section
- What was implemented:
  - Created HowItWorksSection component at /frontend/src/components/landing/HowItWorksSection.tsx
  - Section headline: "Begin Your Adventure in 3 Simple Steps"
  - 3 StepCard components with icons: Home (Gather Your Party), Map (Chart Your Course), Rocket (Adventure Awaits!)
  - PathwayConnector component with stone brick styling (earthBrown color with brick pattern)
  - Vertical layout on mobile, horizontal on tablet/desktop
  - Each step has numbered badge, stone-styled icon container, title, and description
  - CTA button at bottom: "Begin Your Free Quest" linking to /register with hover effects
  - Replaced placeholder How It Works section in LandingPage.tsx with real component

- Files changed:
  - frontend/src/components/landing/HowItWorksSection.tsx (new)
  - frontend/src/pages/LandingPage.tsx (updated import and replaced placeholder)

- **Learnings for future iterations:**
  - Separate mobile and desktop layouts using flex-col md:flex-row and hidden/md:hidden classes
  - Stone brick pathway effect uses earthBrown color with 30% opacity background and 60% opacity brick divs
  - ChevronRight icon rotated 90deg for vertical connectors, normal for horizontal
  - Step number badge positioned absolute -top-3 over the icon container
  - Stone waypoint effect uses inset box-shadows for depth and outer shadow for elevation
---

## 2026-01-12 - US-054 Landing Page Testimonials Section
- What was implemented:
  - Created TestimonialsSection component at /frontend/src/components/landing/TestimonialsSection.tsx
  - Section headline: "Tales from Fellow Adventurers"
  - Carousel with 3 testimonial cards featuring fictional but realistic testimonials
  - Testimonial 1: Marcus T. (Dad of 2) - kid reminds about morning planning
  - Testimonial 2: Jennifer & David K. (Blended family of 6) - coordination across households
  - Testimonial 3: Priya S. (Mom of a 16-year-old) - teenager goal hierarchy revelation
  - BlockyAvatar component with pixelated style (colored rounded squares with initials)
  - StarRating component showing 5 filled star icons
  - Auto-advance every 5 seconds, pauses on hover using useEffect + setInterval
  - CarouselDots component for navigation indicators
  - NavArrow buttons for prev/next navigation
  - Mobile layout: arrows below carousel; Desktop: arrows flanking carousel

- Files changed:
  - frontend/src/components/landing/TestimonialsSection.tsx (new)
  - frontend/src/pages/LandingPage.tsx (added import and TestimonialsSection usage)

- **Learnings for future iterations:**
  - Simple CSS carousel built with absolute positioned cards and opacity transition
  - useCallback for goToNext/goToPrev to avoid dependency issues in useEffect
  - isPaused state controlled via onMouseEnter/onMouseLeave on carousel container
  - Blocky avatar effect: inset box-shadows + corner accent divs for pixelated look
  - Testimonial card height fixed (h-[420px] mobile, h-[380px] desktop) to prevent layout shift
  - isActive prop controls opacity-100 vs opacity-0 + pointer-events-none for card visibility
---

## 2026-01-12 - US-055 Landing Page Pricing Section
- What was implemented:
  - Created PricingSection component at /frontend/src/components/landing/PricingSection.tsx
  - Section headline: "Choose Your Adventure" with subheadline about upgrading when ready
  - 3 pricing tier cards: Seedling (Free), Sapling ($9/mo), Mighty Oak ($19/mo)
  - PricingCard component with tier name, price, member limit, feature checklist, CTA button
  - Sapling tier marked as POPULAR with leafGreen outline and badge
  - Each tier has distinct feature list with Check icons in leafGreen
  - Responsive grid: 1 column on mobile, 3 columns on desktop
  - CTA buttons: "Start Free" (outline), "Start Trial" (filled forest green), "Contact Us" (outline)
  - Trial note below cards: "All plans include a 14-day free trial of Sapling features"
  - Replaced placeholder pricing section in LandingPage.tsx with real component

- Files changed:
  - frontend/src/components/landing/PricingSection.tsx (new)
  - frontend/src/pages/LandingPage.tsx (updated import and replaced placeholder)

- **Learnings for future iterations:**
  - Use `outline` CSS property instead of Tailwind `ring` classes when you need inline style control
  - Popular card uses boxShadow for elevated appearance + outline for highlighted border
  - CTA buttons use onMouseEnter/onMouseLeave for hover background effects on non-popular tiers
  - Feature list uses flex-1 to push CTA button to bottom of card for consistent alignment
  - Price display uses large font (text-4xl/text-5xl) with smaller "/month" or "forever" suffix
---

## 2026-01-12 - US-056 Landing Page FAQ Section
- What was implemented:
  - Created FAQSection component at /frontend/src/components/landing/FAQSection.tsx
  - Section headline: "Questions from the Council"
  - Accordion-style FAQ with 6 questions using shadcn/ui Accordion component (Radix primitives)
  - Q1: Is Entmoot safe for kids? (COPPA compliant, role permissions)
  - Q2: Can I use Entmoot for just myself? (Yes, works for solo)
  - Q3: What happens to my data? (Never sold, export anytime)
  - Q4: Do I need to download an app? (Web-based, mobile apps coming)
  - Q5: Can grandparents or babysitters join? (Yes, as Observers)
  - Q6: What if my family doesn't stick with it? (Gamification helps, cancel anytime)
  - type="single" collapsible ensures only one item open at a time
  - Smooth expand/collapse animation built into Radix Accordion
  - ChevronDown icon rotates to indicate open/closed state
  - Added shadcn/ui Accordion component (installed @radix-ui/react-accordion dependency)

- Files changed:
  - frontend/src/components/landing/FAQSection.tsx (new)
  - frontend/src/components/ui/accordion.tsx (new - shadcn component)
  - frontend/src/pages/LandingPage.tsx (added import and FAQSection usage)
  - frontend/package.json (added @radix-ui/react-accordion dependency)

- **Learnings for future iterations:**
  - shadcn/ui Accordion generates code that needs Prettier fixing (missing semicolons)
  - Run `npm run lint -- --fix` after adding shadcn components to fix formatting
  - Accordion type="single" collapsible allows only one item open, can close all
  - AccordionTrigger has built-in hover:underline that needs to be overridden with hover:no-underline
  - Border color styling on AccordionItem uses inline style with opacity suffix (e.g., `${color}30`)
---

## 2026-01-12 - US-057 Landing Page Final CTA Section
- What was implemented:
  - Created FinalCTASection component at /frontend/src/components/landing/FinalCTASection.tsx
  - Full-width section with sunset gradient background (orange -> pink -> purple)
  - Silhouetted blocky forest at bottom reusing BlockyTree component pattern from HeroSection
  - Headline: "Your Family's Adventure Starts Today"
  - Subheadline: "Join thousands of families building dreams together."
  - Large CTA button: "Start Your Free Adventure" with Rocket icon (forest green bg, white text)
  - Trust text: "No credit card required • Setup in 2 minutes"
  - Generous padding (pt-20/24/32, pb-40/48/56 responsive) and centered content
  - Added FinalCTASection to LandingPage.tsx after FAQSection

- Files changed:
  - frontend/src/components/landing/FinalCTASection.tsx (new)
  - frontend/src/pages/LandingPage.tsx (added import and FinalCTASection usage)

- **Learnings for future iterations:**
  - BlockyTree component pattern is reused from HeroSection - could be extracted to shared module
  - Sunset gradient uses #FF7043 (sunsetOrange) -> #F4511E -> #E91E63 -> #9C27B0 for orange-pink-purple
  - Forest silhouette height is slightly smaller than hero (h-28/36/44 vs h-32/40/48) to feel conclusive
  - Prettier sorts Tailwind classes, so pt-XX must come before pb-XX (pt-20 pb-40 becomes pt-20 pb-40)
  - Using bull HTML entity (&bull;) for bullet separator in trust text
---

## 2026-01-12 - US-058 Landing Page Footer
- What was implemented:
  - Created LandingFooter component at /frontend/src/components/landing/LandingFooter.tsx
  - Dark forest green (#1B3A1A) background as specified in design system
  - Entmoot logo with TreePine icon and tagline "Building family adventures since 2026"
  - 4 link columns: Product (Features, Pricing, Roadmap, Changelog), Company (About, Blog, Careers, Contact), Legal (Privacy, Terms, Cookies, COPPA), Social/Connect
  - Social media icons: Twitter, Instagram, Facebook, Discord (custom SVG icon for Discord)
  - FooterLink component with light colored links that hover to leaf green
  - SocialIcon component with circular hover background effect
  - Responsive grid layout: stacks on mobile, 5 columns on desktop
  - Copyright text with divider above: "© 2026 Entmoot. All rights reserved."
  - Added LandingFooter to LandingPage.tsx after main content

- Files changed:
  - frontend/src/components/landing/LandingFooter.tsx (new)
  - frontend/src/pages/LandingPage.tsx (added import and LandingFooter usage)

- **Learnings for future iterations:**
  - Lucide doesn't have Discord icon - need custom SVG component
  - Use hex color with opacity suffix (e.g., #FFF8E7B3) for inline style opacity
  - FooterColumn reusable component for consistent link list styling
  - Prettier requires `tracking-wider uppercase` order (not `uppercase tracking-wider`)
  - Footer is placed outside main element, after </main> closing tag
---

## 2026-01-12 - US-059 Landing Page Animations and Polish
- What was implemented:
  - Created useScrollAnimation hook at /frontend/src/hooks/useScrollAnimation.ts
  - Created usePrefersReducedMotion hook for detecting reduced motion preference
  - Created AnimatedSection wrapper component at /frontend/src/components/landing/AnimatedSection.tsx
  - Wrapped all landing page sections in AnimatedSection for fade-in-on-scroll animation
  - Added prefers-reduced-motion support to HeroSection (floating islands animation)
  - Added prefers-reduced-motion support to SocialProofBar (count-up animation)
  - All existing animations verified: button hover effects, feature card hover, smooth scroll, carousel, accordion

- Files changed:
  - frontend/src/hooks/useScrollAnimation.ts (new)
  - frontend/src/components/landing/AnimatedSection.tsx (new)
  - frontend/src/components/landing/HeroSection.tsx (added reduced motion support)
  - frontend/src/components/landing/SocialProofBar.tsx (added reduced motion support)
  - frontend/src/components/landing/ProblemSolutionSection.tsx (wrapped in AnimatedSection)
  - frontend/src/components/landing/FeaturesSection.tsx (wrapped in AnimatedSection)
  - frontend/src/components/landing/HowItWorksSection.tsx (wrapped in AnimatedSection)
  - frontend/src/components/landing/TestimonialsSection.tsx (wrapped in AnimatedSection)
  - frontend/src/components/landing/PricingSection.tsx (wrapped in AnimatedSection)
  - frontend/src/components/landing/FAQSection.tsx (wrapped in AnimatedSection)
  - frontend/src/components/landing/FinalCTASection.tsx (wrapped in AnimatedSection)

- **Learnings for future iterations:**
  - To avoid setState-in-effect lint error: set initial useState value from condition, don't set in useEffect
  - usePrefersReducedMotion hook listens to media query changes for dynamic preference updates
  - AnimatedSection uses opacity + translate-y transition for smooth fade-in effect
  - Intersection Observer threshold of 0.2 works well for section-level animations
  - Pass duration (0 or skip) to count-up hook for immediate display when motion reduced
  - FloatingIsland component accepts animate prop to conditionally apply CSS animation class
---

## 2026-01-12 - US-060 Landing Page SEO and Meta Tags
- What was implemented:
  - Installed react-helmet-async package for dynamic meta tag management
  - Created LandingPageSEO component at /frontend/src/components/landing/LandingPageSEO.tsx
  - Page title: "Entmoot - Family Goal Planning Made Fun | Build Your Adventure Together"
  - Meta description about transforming family chaos into epic adventures
  - Open Graph tags (og:title, og:description, og:image, og:type, og:url, og:site_name)
  - Twitter card meta tags (summary_large_image)
  - Canonical URL set to https://entmoot.app
  - Updated index.html with default fallback meta tags for crawlers/pre-renderers
  - Wrapped app with HelmetProvider in main.tsx
  - Added aria-hidden="true" and role="presentation" to decorative SVGs in HeroSection and FinalCTASection
  - Verified semantic HTML structure (header, nav, main, section, footer already in place)

- Files changed:
  - frontend/src/components/landing/LandingPageSEO.tsx (new)
  - frontend/src/main.tsx (wrapped with HelmetProvider)
  - frontend/src/pages/LandingPage.tsx (added LandingPageSEO import and usage)
  - frontend/index.html (added default meta tags)
  - frontend/src/components/landing/HeroSection.tsx (aria-hidden on decorative SVGs)
  - frontend/src/components/landing/FinalCTASection.tsx (aria-hidden on decorative SVGs)
  - frontend/package.json (added react-helmet-async dependency)

- **Learnings for future iterations:**
  - react-helmet-async is the modern fork of react-helmet for React 18 concurrent mode
  - HelmetProvider must wrap the entire app at the root level in main.tsx
  - index.html should have fallback meta tags for crawlers that don't execute JavaScript
  - Decorative SVGs should have aria-hidden="true" and role="presentation" for accessibility
  - AnimatedSection component already uses <section> by default - good semantic HTML
  - The OG image path is placeholder (/og-image.png) - actual image needs to be created later
---

## 2026-01-12 - US-061 React Native Project Setup with Expo
- What was implemented:
  - Created Expo project in /mobile directory with TypeScript template (React 19, Expo ~54)
  - Set up environment configuration in src/lib/config.ts for dev/staging/prod API endpoints
  - Configured React Navigation with AuthNavigator (stack), MainTabNavigator (bottom tabs), and RootNavigator (root stack)
  - Created shared type definitions in /shared/types/index.ts (User, Family, Goal, DailyPlan, Notification, etc.)
  - ESLint flat config and Prettier configured matching web frontend style
  - Updated app.json with Entmoot branding, iOS/Android bundle identifiers, design system colors
  - Created navigation types for type-safe navigation throughout the app

- Files created/changed:
  - mobile/package.json (with scripts: start, ios, android, lint, typecheck)
  - mobile/app.json (Entmoot branding, bundle identifiers)
  - mobile/tsconfig.json (strict mode, path aliases for @/ and @shared/)
  - mobile/eslint.config.js (ESLint 9 flat config)
  - mobile/.prettierrc (matching web frontend)
  - mobile/App.tsx (NavigationContainer, SafeAreaProvider, RootNavigator)
  - mobile/src/lib/config.ts (environment configuration)
  - mobile/src/navigation/types.ts (type-safe navigation param lists)
  - mobile/src/navigation/AuthNavigator.tsx (Login, Register, ForgotPassword)
  - mobile/src/navigation/MainTabNavigator.tsx (Dashboard, Goals, DailyPlanner, Family, Settings tabs)
  - mobile/src/navigation/RootNavigator.tsx (auth flow switching)
  - mobile/src/navigation/index.ts (exports)
  - shared/types/index.ts (all shared type definitions)

- **Learnings for future iterations:**
  - Expo 54 with React Native 0.81 requires Node >= 20.19.4 officially, but works with Node 18 (with warnings)
  - ESLint 9 uses flat config format (eslint.config.js) not .eslintrc.* files
  - React Navigation 7 with native-stack and bottom-tabs works well together
  - Use NavigatorScreenParams for nested navigators in type definitions
  - For React Navigation global type declarations, need to disable both @typescript-eslint/no-namespace and @typescript-eslint/no-empty-object-type
  - Mobile structure: /mobile/src/{screens,components,hooks,lib,stores,navigation}
  - Shared types allow code reuse between web and mobile but need tsconfig paths configured
  - Design system colors should be consistent: creamWhite #FFF8E7 for background, forestGreen #2D5A27 for primary
- PushNotificationService uses googleauth gem for FCM HTTP v1 API authentication (not firebase-admin)
- DeviceToken platforms: 'ios', 'android', 'web' - validated via inclusion
- Device token cleanup: on 400/404 FCM response with error codes UNREGISTERED, INVALID_ARGUMENT, NOT_FOUND
---

## 2026-01-12 - US-062 Mobile Authentication Flow
- What was implemented:
  - Created API client lib (mobile/src/lib/api.ts) with auto token refresh and error handling
  - Created auth service (mobile/src/lib/auth.ts) mirroring web frontend patterns
  - Created Zustand auth store (mobile/src/stores/auth.ts) with expo-secure-store for secure token storage
  - Login screen with email/password fields, validation, error handling, and loading states
  - Registration screen with name/email/password/confirmation, validation, and loading states
  - Forgot Password screen with email input and success confirmation view
  - Updated App.tsx to initialize auth store and display loading screen while initializing
  - Added zustand and expo-secure-store dependencies

- Files created/changed:
  - mobile/src/lib/api.ts (ApiClient class with auto token refresh)
  - mobile/src/lib/auth.ts (login, register, logout, refreshTokens, requestPasswordReset)
  - mobile/src/stores/auth.ts (Zustand store with SecureStore persistence)
  - mobile/src/stores/index.ts (exports)
  - mobile/src/screens/auth/LoginScreen.tsx
  - mobile/src/screens/auth/RegisterScreen.tsx
  - mobile/src/screens/auth/ForgotPasswordScreen.tsx
  - mobile/src/screens/auth/index.ts
  - mobile/src/screens/index.ts
  - mobile/src/navigation/AuthNavigator.tsx (updated to use actual screen components)
  - mobile/App.tsx (uses auth store, shows loading while initializing)
  - mobile/package.json (added zustand, expo-secure-store)

- **Learnings for future iterations:**
  - React Native doesn't have DOM types like RequestInit - define custom FetchOptions interface
  - Use &apos; instead of apostrophes in JSX text content to satisfy react/no-unescaped-entities
  - Zustand store initialization with SecureStore is async - need isInitialized flag
  - Auto token refresh: intercept 401 responses, call refresh endpoint, retry original request
  - apiClient.setOnTokenRefresh callback updates store and SecureStore when tokens are refreshed
  - Mobile screens follow same design system colors as landing page (creamWhite, forestGreen, earthBrown, darkForest)
  - Form validation patterns: validateForm() returns boolean, setErrors updates state, clearFieldError on change
---

## 2026-01-13 - US-063 Push Notification Infrastructure - Backend
- What was implemented:
  - Added googleauth gem (~> 1.8) to Gemfile for FCM HTTP v1 API authentication
  - Created DeviceToken model with user_id, token, platform, device_name, last_used_at fields
  - Added device_tokens migration with unique index on token and composite index on user_id+token
  - Created DeviceTokensController with create, destroy, and unregister actions
  - Created PushNotificationService for FCM HTTP v1 API with iOS (APNs), Android, and web support
  - Updated NotificationService.send_push_notification to dispatch push when user has push:true preference
  - Implemented automatic cleanup of invalid device tokens on FCM error responses
  - Added request specs for all device token endpoints (24 examples)
  - Added service specs for PushNotificationService (13 examples)

- Files created/changed:
  - backend/Gemfile (added googleauth gem)
  - backend/db/migrate/20260113001413_create_device_tokens.rb (new)
  - backend/app/models/device_token.rb (new)
  - backend/app/models/user.rb (added has_many :device_tokens)
  - backend/app/controllers/api/v1/device_tokens_controller.rb (new)
  - backend/config/routes.rb (added device_tokens routes)
  - backend/app/services/push_notification_service.rb (new)
  - backend/app/services/notification_service.rb (added push notification dispatch)
  - backend/spec/factories/device_tokens.rb (new)
  - backend/spec/requests/api/v1/device_tokens_spec.rb (new)
  - backend/spec/services/push_notification_service_spec.rb (new)

- **Learnings for future iterations:**
  - Use googleauth gem instead of firebase-admin for FCM HTTP v1 API - lighter weight
  - FCM HTTP v1 endpoint format: https://fcm.googleapis.com/v1/projects/{project_id}/messages:send
  - DeviceToken.active scope: last_used_at > 30.days.ago OR last_used_at is nil
  - Platform-specific config: iOS uses apns.payload.aps.sound, Android uses android.priority + notification.channel_id
  - FCM requires all data values to be strings - use transform_values(&:to_s)
  - Invalid token error codes: UNREGISTERED, INVALID_ARGUMENT, NOT_FOUND
  - In development, PushNotificationService logs messages instead of calling FCM
  - NotificationService.send_push_notification respects user's push preference and quiet hours
---

## 2026-01-13 - US-064 Push Notification Infrastructure - Mobile
- What was implemented:
  - Added expo-notifications and expo-device dependencies to package.json
  - Configured app.json with FCM sender ID, APNs UIBackgroundModes, and notification icon
  - Created pushNotifications.ts with setNotificationHandler, permission requests, token management
  - Created deviceTokens.ts for backend API integration (register/unregister tokens)
  - Created usePushNotifications hook for notification listeners and deep link navigation
  - Updated auth store to register for push on login/register and unregister on logout
  - Added DeviceToken types to shared/types/index.ts
  - Integrated PushNotificationHandler component in App.tsx for authenticated users

- Files created/changed:
  - mobile/package.json (added expo-device, expo-notifications)
  - mobile/app.json (FCM, APNs, notification plugin config)
  - mobile/src/lib/pushNotifications.ts (new)
  - mobile/src/lib/deviceTokens.ts (new)
  - mobile/src/hooks/usePushNotifications.ts (new)
  - mobile/src/hooks/index.ts (new)
  - mobile/src/stores/auth.ts (push registration on login/logout)
  - mobile/App.tsx (PushNotificationHandler component)
  - shared/types/index.ts (DeviceToken, DevicePlatform types)

- **Learnings for future iterations:**
  - expo-notifications setNotificationHandler configures foreground notification behavior (shouldShowAlert, etc.)
  - expo-device provides Device.isDevice check - push only works on physical devices
  - Expo push token requires projectId from Constants.expoConfig.extra.eas.projectId
  - parseNotificationLink maps backend link field to React Navigation routes for deep linking
  - PushNotificationHandler must be inside NavigationContainer for useNavigation to work
  - Register for push asynchronously after login to avoid blocking auth flow
  - Unregister from push before logout to ensure token is removed with valid auth
  - Navigation typing is strict - handle each route explicitly instead of dynamic navigation
---

## 2026-01-13 - US-065 Mobile Dashboard Screen
- What was implemented:
  - Created DashboardScreen component with time-based greeting (Good morning/afternoon/evening)
  - Added family switcher modal for users with multiple families
  - Displayed quick stats: tasks completed today and total streak days
  - Showed individual streaks with emoji icons and day/week counts
  - Added quick action buttons for Morning Planning, Evening Reflection, Weekly Review
  - Implemented recent notifications section with unread indicators
  - Added pull-to-refresh functionality with RefreshControl
  - Created loading state with ActivityIndicator while data loads
  - Created mobile API lib files: families.ts, streaks.ts, notifications.ts, dailyPlans.ts
  - Updated MainTabNavigator to use actual DashboardScreen component

- Files created/changed:
  - mobile/src/lib/dailyPlans.ts (new)
  - mobile/src/lib/families.ts (new)
  - mobile/src/lib/notifications.ts (new)
  - mobile/src/lib/streaks.ts (new)
  - mobile/src/lib/index.ts (new - exports all lib modules)
  - mobile/src/screens/main/DashboardScreen.tsx (new)
  - mobile/src/screens/main/index.ts (new)
  - mobile/src/screens/index.ts (added main screens export)
  - mobile/src/navigation/MainTabNavigator.tsx (imports DashboardScreen)

- **Learnings for future iterations:**
  - Mobile API lib files use authFetch from api.ts (no token param needed - tokens handled by apiClient)
  - getTimeBasedGreeting helper: before 12pm = morning, 12-5pm = afternoon, after 5pm = evening
  - Family switcher only shown when user has > 1 family, otherwise shows simple badge
  - Quick stats show tasks_completed/total from daily plan completion_stats
  - Total streak count aggregated from all streak types in array
  - Use FlatList inside Modal for family selection list
  - RefreshControl props: refreshing, onRefresh, tintColor (iOS), colors (Android)
  - Navigation.navigate to sibling tabs works from MainTabScreenProps
---
